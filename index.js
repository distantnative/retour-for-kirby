(function(){"use strict";const Nt="";function a(e,t,s,r,n,u,c,At){var i=typeof e=="function"?e.options:e;t&&(i.render=t,i.staticRenderFns=s,i._compiled=!0),r&&(i.functional=!0),u&&(i._scopeId="data-v-"+u);var l;if(c?(l=function(o){o=o||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!o&&typeof __VUE_SSR_CONTEXT__<"u"&&(o=__VUE_SSR_CONTEXT__),n&&n.call(this,o),o&&o._registeredComponents&&o._registeredComponents.add(c)},i._ssrRegister=l):n&&(l=At?function(){n.call(this,(i.functional?this.parent:this).$root.$options.shadowRoot)}:n),l)if(i.functional){i._injectStyles=l;var Pt=i.render;i.render=function(Tt,f){return l.call(f),Pt(Tt,f)}}else{var p=i.beforeCreate;i.beforeCreate=p?[].concat(p,l):[l]}return{exports:e,options:i}}const h={props:{data:[Object,Array],stats:[Boolean,Array],tab:String,tabs:Array,timespan:Object},data(){return{searching:!1,q:null,pagination:{page:1,limit:50}}},computed:{buttons(){return[]},columns(){return{}},empty(){return{}},filteredItems(){let e=this.data;return this.q&&(e=e.filter(t=>JSON.stringify(t).toLowerCase().includes(this.q.toLowerCase()))),e},paginatedItems(){return this.filteredItems.slice(this.pagination.limit*(this.pagination.page-1),this.pagination.limit*this.pagination.page)}},methods:{options(e){return[]},id(e){return encodeURIComponent(e.replace(/\//g,""))}}};var m=function(){var t=this,s=t._self._c;return s("k-inside",{staticClass:"k-retour-view k-retour-collection-view",scopedSlots:t._u([t.stats?{key:"topbar",fn:function(){return[s("k-retour-timespan",{attrs:{timespan:t.timespan}})]},proxy:!0}:null],null,!0)},[t.stats?s("k-retour-stats",{attrs:{data:t.stats,timespan:t.timespan}}):t._e(),s("k-retour-tabs",{attrs:{tab:t.tab,tabs:t.tabs},scopedSlots:t._u([{key:"buttons",fn:function(){return[s("k-button-group",{attrs:{buttons:[{icon:"search",click:()=>t.searching=!t.searching},...t.buttons],size:"sm",variant:"filled"}})]},proxy:!0}])}),t.searching?s("k-input",{staticClass:"k-models-section-search",attrs:{autofocus:!0,placeholder:t.$t("search")+" â€¦",value:t.q,type:"text"},on:{input:function(r){t.q=r,t.pagination.page=1},keydown:function(r){if(!r.type.indexOf("key")&&t._k(r.keyCode,"esc",27,r.key,["Esc","Escape"]))return null;t.searching=!1,t.q=null}}}):t._e(),s("k-collection",{attrs:{columns:t.columns,empty:t.empty,items:t.paginatedItems,pagination:{...t.pagination,total:t.filteredItems.length},layout:"table"},on:{paginate:function(r){t.pagination.page=r.page}},scopedSlots:t._u([{key:"options",fn:function({item:r}){return[s("k-options-dropdown",{attrs:{options:t.options(r)}})]}}])}),t.stats?t._e():s("k-text",{staticClass:"k-help",domProps:{innerHTML:t._s(`${this.$t("retour.system.support")}: ðŸ’› <a href='https://paypal.me/distantnative'><strong> ${this.$t("retour.system.support.donate")}</strong></a>`)}})],1)},v=[],$=a(h,m,v,!1,null,null,null,null);const _=$.exports;var y=a({extends:_,computed:{buttons(){return[{icon:"add",text:this.$t("add"),click:()=>this.$drawer("retour/redirects/create")}]},columns(){let e={from:{label:this.$t("retour.redirects.from"),type:"path",width:"7/20"},to:{label:this.$t("retour.redirects.to"),type:"path",width:"7/20"},status:{label:this.$t("retour.redirects.status"),type:"status",width:"1/10"},priority:{label:this.$t("retour.redirects.priority.abbr"),type:"priority",width:"1/10"}};return this.stats&&(e.hits={label:this.$t("retour.hits"),width:"1/10",type:"count"}),e},empty(){return{icon:"shuffle",text:this.$t("retour.redirects.empty")}}},methods:{options(e){return[{text:this.$t("edit"),icon:"edit",click:()=>this.$drawer(`retour/redirects/${this.id(e.from)}/edit`)},{text:this.$t("remove"),icon:"trash",click:()=>this.$dialog(`retour/redirects/${this.id(e.from)}/delete`)}]}}},null,null,!1,null,null,null,null);const b=y.exports;var k=a({extends:_,computed:{buttons(){return[{icon:"trash",text:this.$t("retour.failures.clear"),click:()=>this.$dialog("retour/failures/flush")}]},columns(){return{path:{label:this.$t("retour.failures.path"),type:"path",width:"1/2"},referrer:{label:this.$t("retour.failures.referrer"),type:"path",width:"1/2"},hits:{label:this.$t("retour.hits"),type:"count",width:"1/12",align:"right"}}},empty(){return{icon:"alert",text:this.$t("retour.failures.empty")}}},methods:{options(e){return[{text:this.$t("retour.failures.resolve"),icon:"add",click:()=>this.$drawer(`retour/failures/${this.id(e.path)}/resolve`)},{text:this.$t("remove"),icon:"trash",click:()=>this.$dialog(`retour/failures/${this.id(e.path)}/delete`)}]}}},null,null,!1,null,null,null,null);const g=k.exports,Bt="",x={props:{data:[Object,Array],stats:[Boolean,Array],tabs:Array,timespan:Object},computed:{reports(){return[{label:this.$t("retour.system.redirects"),value:this.data.redirects},{label:this.$t("retour.system.failures"),value:this.data.failures},{label:this.$t("retour.system.deleteAfter"),value:this.$t("retour.system.deleteAfter.months",{count:this.data.deleteAfter})},{label:this.$t("retour.system.support"),value:`ðŸ’› ${this.$t("retour.system.support.donate")}`,link:"https://paypal.me/distantnative",theme:"positive"}]}}};var w=function(){var t=this,s=t._self._c;return s("k-inside",{staticClass:"k-retour-view k-retour-system-view",scopedSlots:t._u([{key:"topbar",fn:function(){return[s("k-retour-timespan",{attrs:{timespan:t.timespan}})]},proxy:!0}])},[t.stats?s("k-retour-stats",{attrs:{data:t.stats,timespan:t.timespan}}):t._e(),s("k-retour-tabs",{attrs:{tabs:t.tabs,tab:"system"}}),s("k-stats",{attrs:{reports:t.reports}}),s("k-text",{staticClass:"k-help",domProps:{innerHTML:t._s(t.$t("retour.system.docs",{docs:"https://github.com/distantnative/retour-for-kirby"}))}})],1)},Y=[],C=a(x,w,Y,!1,null,null,null,null);const j=C.exports,Lt="",O={props:{data:Array},computed:{gradient(){let e="",t=0;const s=this.total/180;for(let r=0;r<this.data.length;r++)e+=`${this.data[r].color} ${t}deg,`,t+=this.data[r].data/s,e+=`${this.data[r].color} ${t}deg,`;return e+="transparent 180deg",e},total(){return this.data.reduce((e,t)=>e+=t.data,0)}}};var F=function(){var t=this,s=t._self._c;return s("figure",{staticClass:"chart-pie"},[s("div",{staticClass:"graph",style:"--gradient: "+t.gradient}),s("figcaption",[t._l(t.data,function(r){return[s("k-icon",{key:r.label+"-icon",style:"--color:"+r.color,attrs:{type:"circle"}}),s("div",{key:r.label+"-no"},[t._v(" "+t._s(new Intl.NumberFormat().format(r.data))+" ")]),s("div",{key:r.label+"-label"},[t._v(" "+t._s(r.label)+" ")])]})],2)])},M=[],S=a(O,F,M,!1,null,null,null,null);const R=S.exports,Ut="",D={props:{data:Array,timespan:Object},computed:{axisY(){const e=this.max/5;return[1,2,3,4,5].map(t=>{let s=t*e;return s>=1e3&&(s=Math.floor(s/100)/10+"k"),s})},format(){return{day:"HH",week:"ddd",month:"D",year:"MMM",months:"MMM YY"}[this.timespan.unit]??"D MMM"},subunit(){return{day:"hour",year:"month"}[this.timespan.unit]??"day"},max(){let e=Math.max(...this.data.map(t=>t.areas.reduce((s,r)=>s+=r.data,0)));if(e>0){const t=e.toString().length,s=Math.pow(10,t)/4;return Math.ceil(e*1.1/s)*s}return 5}},methods:{bounds(e,t){const s=e.areas.slice(0,t).reduce((r,n)=>r+=n.data,0);return{path:s+e.areas[t].data,mask:s}},clip(e,t){let s=this.bounds(this.data[e],t),r={path:0,mask:0};return this.data[e+1]&&(r=this.bounds(this.data[e+1],t)),`--p0: ${s.path/this.max}; --p1: ${r.path/this.max}; --m0: ${s.mask/this.max}; --m1: ${r.mask/this.max};`},color(e,t){const s=this.data[e+1];if(s){const r=this.$library.dayjs(s.label),n=this.$library.dayjs();if(r.isAfter(n,this.subunit))return"transparent"}return t.color},isCurrent(e){const t=this.$library.dayjs();return this.$library.dayjs(e.label).isSame(t,this.subunit)},label(e){return this.$library.dayjs(e.label).format(this.format)},onZoom(e){const t=this.$library.dayjs(e.label);this.$reload({query:{from:t.startOf(this.subunit).format("YYYY-MM-DD"),to:t.endOf(this.subunit).format("YYYY-MM-DD")}})}}};var A=function(){var t=this,s=t._self._c;return s("table",{staticClass:"chart-areas"},[s("thead",[s("tr",t._l(t.axisY,function(r){return s("th",{key:r},[t._v(" "+t._s(r)+" ")])}),0)]),s("tbody",t._l(t.data,function(r,n){return s("tr",{key:n,on:{dblclick:function(u){return t.onZoom(r)}}},t._l(r.areas,function(u,c){return s("td",{key:n+"_"+c,style:`--color: ${t.color(n,u)}; ${t.clip(n,c)}`})}),0)}),0),s("tfoot",{attrs:{"data-less":t.data.length>30}},t._l(t.data,function(r){return s("tr",{key:r.label,attrs:{"data-current":t.isCurrent(r)},on:{dblclick:function(n){return t.onZoom(r)}}},[s("td",[t._v(t._s(t.label(r)))])])}),0)])},P=[],T=a(D,A,P,!1,null,null,null,null);const N=T.exports,Zt="",q={components:{Pie:R,Timeline:N},props:{data:Array,timespan:Object},computed:{areas(){return this.data.map(e=>({label:e.date,areas:[{data:e.redirected,color:"var(--color-blue-600)"},{data:e.resolved,color:"var(--color-gray-300)"},{data:e.failed,color:"var(--color-red-600)"}]}))},pie(){return[{data:this.data.reduce((e,t)=>e+=t.redirected,0),color:"var(--color-blue-600)",label:this.$t("retour.stats.redirected")},{data:this.data.reduce((e,t)=>e+=t.resolved,0),color:"var(--color-gray-300)",label:this.$t("retour.stats.resolved")},{data:this.data.reduce((e,t)=>e+=t.failed,0),color:"var(--color-red-600)",label:this.$t("retour.stats.failed")}]}}};var V=function(){var t=this,s=t._self._c;return s("section",{staticClass:"k-retour-stats"},[s("pie",{attrs:{data:t.pie}}),s("timeline",{attrs:{data:t.areas,timespan:t.timespan}})],1)},I=[],z=a(q,V,I,!1,null,null,null,null);const H=z.exports,Wt="",E={props:{tab:String,tabs:Array}};var B=function(){var t=this,s=t._self._c;return s("div",{staticClass:"k-retour-tabs",attrs:{"data-end":t.tabs.length<2}},[s("k-tabs",{attrs:{tab:t.tab,tabs:t.tabs}}),t._t("buttons")],2)},L=[],U=a(E,B,L,!1,null,null,null,null);const Z=U.exports,Xt="",W={props:{dates:Object,timespan:Object},computed:{label(){const e=this.dates.from,t=this.dates.to;return this.timespan.unit==="day"?`${e.format("D")} ${this.month(e)} ${e.format("YYYY")}`:this.timespan.unit==="month"?`${this.month(e)} ${e.format("YYYY")}`:this.timespan.unit==="year"?`${e.format("YYYY")}`:e.isSame(t,"month")?`
        ${e.format("D")} - ${t.format("D")}
        ${this.month(t)} ${t.format("YYYY")}
        `:e.isSame(t,"year")?`
        ${e.format("D")} ${this.month(e)} -
        ${t.format("D")} ${this.month(t)} ${t.format("YYYY")}
        `:`
      ${e.format("D")} ${this.month(e)} ${e.format("YYYY")} -
      ${t.format("D")} ${this.month(t)} ${t.format("YYYY")}`},value(){return Object.values(this.dates).map(e=>e.format("YYYY-MM-DD HH:mm:ss"))}},methods:{month(e){return e=e.format("MMMM"),e=this.$helper.string.lcfirst(e),this.$t("months."+e)}}};var X=function(){var t=this,s=t._self._c;return s("span",{staticClass:"k-retour-dates",attrs:{title:t.label}},[s("k-icon",{attrs:{type:"calendar"}}),s("span",[t._v(t._s(t.label))])],1)},J=[],G=a(W,X,J,!1,null,null,null,null);const K=G.exports,Jt="",Q={props:{dates:Object,timespan:Object},computed:{first(){return this.$library.dayjs(this.timespan.first)},last(){return this.$library.dayjs(this.timespan.last)},hasPrev(){return this.dates.from.isAfter(this.first)},hasNext(){return this.dates.to.isBefore(this.last)||this.dates.to.isBefore(this.$library.dayjs())},isAll(){return this.dates.from.isSame(this.first,"day")&&this.dates.to.isSame(this.last,"day")}},methods:{isCurrent(e){return e==="all"?this.isAll:e===this.timespan.unit},isDisabled(e){return e==="all"&&(!this.timespan.first||!this.timespan.last)},set(e){if(e==="all")return this.$emit("navigate",{from:this.first,to:this.last});let t=Object.assign({},this.dates);e===this.timespan.unit&&(t={from:this.$library.dayjs(),to:this.$library.dayjs()}),this.$emit("navigate",{from:t.from.startOf(e),to:t.from.endOf(e)})},onNavigate(e){let t=this.timespan.unit,s=1;t==="week"&&(s=7,t="day"),this.$emit("navigate",{from:this.dates.from[e](s,t).startOf(t),to:this.dates.to[e](s,t).endOf(t)})}}};var tt=function(){var t=this,s=t._self._c;return s("k-button-group",{staticClass:"k-retour-prevnext",attrs:{layout:"collapsed"}},[s("k-button",{attrs:{icon:"angle-left",size:"xs",variant:"filled",disabled:!t.hasPrev||t.isAll},on:{click:function(r){return t.onNavigate("subtract")}}}),t._l(["all","year","month","day"],function(r){return s("k-button",{key:r,attrs:{current:t.isCurrent(r),disabled:t.isDisabled(r),size:"xs",variant:"filled"},on:{click:function(n){return t.set(r)}}},[t._v(" "+t._s(t.$t("retour.stats.mode."+r))+" ")])}),s("k-button",{attrs:{disabled:!t.hasNext||t.isAll,icon:"angle-right",size:"xs",variant:"filled"},on:{click:function(r){return t.onNavigate("add")}}})],2)},et=[],st=a(Q,tt,et,!1,null,null,null,null);const rt=st.exports,Gt="",at={components:{Dates:K,PrevNext:rt},props:{timespan:Object},computed:{dates(){return{from:this.$library.dayjs(this.timespan.from),to:this.$library.dayjs(this.timespan.to)}}},methods:{navigate(e){this.$reload({query:{from:e.from.format("YYYY-MM-DD"),to:e.to.format("YYYY-MM-DD")}})}}};var nt=function(){var t=this,s=t._self._c;return s("k-bar",{staticClass:"k-retour-timespan"},[s("dates",{attrs:{dates:t.dates,timespan:t.timespan},on:{navigate:t.navigate}}),s("prev-next",{attrs:{dates:t.dates,timespan:t.timespan},on:{navigate:t.navigate}})],1)},it=[],ot=a(at,nt,it,!1,null,null,null,null);const lt=ot.exports,Kt="",ut={props:{row:Object},computed:{title(){return this.$t("retour.hits.last")+": "+this.row.last}}};var ct=function(){var t=this,s=t._self._c;return s("div",{staticClass:"k-count-preview-field",attrs:{title:t.title}},[t.row.hits>0?[t._v(" "+t._s(t.row.hits)+" "),s("k-icon",{attrs:{title:t.title,type:"clock"}})]:s("p",[t._v("â€“")])],2)},_t=[],dt=a(ut,ct,_t,!1,null,null,null,null);const pt=dt.exports,ft={props:{column:{type:Object,default:()=>({})},field:Object,value:[String,Object]},computed:{isExternal(){return this.value&&this.value.startsWith("http")},link(){return this.isExternal?this.value:window.panel.$urls.site+"/"+this.value}}};var ht=function(){var t=this,s=t._self._c;return s("p",{staticClass:"k-url-field-preview k-path-field-preview"},[s("k-link",{attrs:{to:t.link,title:`${t.column.label}: ${t.value}`},nativeOn:{click:function(r){r.stopPropagation()}}},[t._v(" "+t._s(t.value)+" ")])],1)},mt=[],vt=a(ft,ht,mt,!1,null,null,null,null);const $t=vt.exports,Qt="",yt={props:{value:String,column:Object}};var bt=function(){var t=this,s=t._self._c;return s("div",{staticClass:"k-priority-field-preview"},[t.value?s("k-icon",{attrs:{type:"bolt",title:t.column.label}}):s("p",[t._v("â€“")])],1)},kt=[],gt=a(yt,bt,kt,!1,null,null,null,null);const xt=gt.exports,d={computed:{color(){return this.value?parseInt(this.value)>=400?"var(--color-negative-light)":parseInt(this.value)>=300?"var(--color-positive-light)":"var(--color-focus-light)":"var(--color-border)"}}},te="",wt={mixins:[d],props:{value:String,row:Object,column:Object}};var Yt=function(){var t=this,s=t._self._c;return s("div",{staticClass:"k-status-field-preview",attrs:{title:`${t.column.label}: ${t.value??"-"}`}},[s("k-icon",{style:"color: "+t.color,attrs:{type:"circle-filled"}}),t.value?s("code",[t._v(t._s(t.value))]):s("span",[t._v("Â â€“")])],1)},Ct=[],jt=a(wt,Yt,Ct,!1,null,null,null,null);const Ot=jt.exports,Ft={extends:"k-select-field",mixins:[d],methods:{onInput(e){this.value=e}}};var Mt=function(){var t=this,s=t._self._c;return s("k-field",t._b({staticClass:"k-select-field",attrs:{input:t._uid}},"k-field",t.$props,!1),[s("k-input",t._g(t._b({ref:"input",attrs:{id:t._uid,type:"select",theme:"field"},on:{input:t.onInput},scopedSlots:t._u([{key:"before",fn:function(){return[s("k-icon",{attrs:{type:"circle-filled",color:t.color}})]},proxy:!0}])},"k-input",t.$props,!1),t.$listeners))],1)},St=[],Rt=a(Ft,Mt,St,!1,null,null,null,null);const Dt=Rt.exports;panel.plugin("distantnative/retour",{components:{"k-count-field-preview":pt,"k-path-field-preview":$t,"k-priority-field-preview":xt,"k-status-field-preview":Ot,"k-retour-stats":H,"k-retour-tabs":Z,"k-retour-timespan":lt,"k-retour-redirects-view":b,"k-retour-failures-view":g,"k-retour-system-view":j},fields:{"retour-status":Dt}})})();
