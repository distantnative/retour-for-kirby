(function(){"use strict";const Mt="";function n(r,t,e,s,a,c,u,xt){var i=typeof r=="function"?r.options:r;t&&(i.render=t,i.staticRenderFns=e,i._compiled=!0),s&&(i.functional=!0),c&&(i._scopeId="data-v-"+c);var o;if(u?(o=function(l){l=l||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!l&&typeof __VUE_SSR_CONTEXT__<"u"&&(l=__VUE_SSR_CONTEXT__),a&&a.call(this,l),l&&l._registeredComponents&&l._registeredComponents.add(u)},i._ssrRegister=o):a&&(o=xt?function(){a.call(this,(i.functional?this.parent:this).$root.$options.shadowRoot)}:a),o)if(i.functional){i._injectStyles=o;var Ct=i.render;i.render=function(Ft,f){return o.call(f),Ct(Ft,f)}}else{var p=i.beforeCreate;i.beforeCreate=p?[].concat(p,o):[o]}return{exports:r,options:i}}const h={props:{data:[Object,Array],stats:[Boolean,Array],tab:String,tabs:Array,timespan:Object},data(){return{searching:!1,q:null,pagination:{page:1,limit:20}}},computed:{buttons(){return[]},columns(){return{}},empty(){return{}},filteredItems(){let r=this.data;return this.q&&(r=r.filter(t=>JSON.stringify(t).toLowerCase().includes(this.q.toLowerCase()))),r},help(){if(!this.stats)return`${this.$t("retour.system.support")}: ðŸ’› <a href='https://paypal.me/distantnative'><strong> ${this.$t("retour.system.support.donate")}</strong></a>`},paginatedItems(){return this.filteredItems.slice(this.pagination.limit*(this.pagination.page-1),this.pagination.limit*this.pagination.page)}},methods:{id(r){return encodeURIComponent(r.replace(/\//g,""))},onCell({row:r,columnIndex:t}){},options(r){return[]},toggleSearch(){this.searching=!this.searching,this.q=null}}};var m=function(){var t=this,e=t._self._c;return e("k-inside",{staticClass:"k-retour-view k-retour-collection-view",scopedSlots:t._u([t.stats?{key:"topbar",fn:function(){return[e("k-retour-timespan",{attrs:{timespan:t.timespan}})]},proxy:!0}:null],null,!0)},[t.stats?e("k-retour-stats",{attrs:{data:t.stats,timespan:t.timespan}}):t._e(),e("k-retour-tabs",{attrs:{tab:t.tab,tabs:t.tabs},scopedSlots:t._u([{key:"buttons",fn:function(){return[e("k-button-group",{attrs:{buttons:[{icon:"search",click:t.toggleSearch},...t.buttons],size:"sm",variant:"filled"}})]},proxy:!0}])}),t.searching?e("k-input",{staticClass:"k-models-section-search",attrs:{autofocus:!0,placeholder:t.$t("search")+" â€¦",value:t.q,type:"text"},on:{input:function(s){t.q=s,t.pagination.page=1},keydown:function(s){return!s.type.indexOf("key")&&t._k(s.keyCode,"esc",27,s.key,["Esc","Escape"])?null:t.toggleSearch.apply(null,arguments)}}}):t._e(),t.filteredItems.length===0?e("k-empty",t._b({attrs:{layout:"table"}},"k-empty",t.empty,!1)):e("k-table",{attrs:{columns:t.columns,rows:t.paginatedItems},on:{cell:t.onCell},scopedSlots:t._u([{key:"options",fn:function({row:s}){return[e("k-options-dropdown",{attrs:{options:t.options(s)}})]}}])}),e("footer",{staticClass:"k-bar k-collection-footer"},[e("k-text",{staticClass:"k-help",domProps:{innerHTML:t._s(t.help)}}),e("k-pagination",t._b({attrs:{details:!0,total:t.filteredItems.length},on:{paginate:function(s){t.pagination.page=s.page}}},"k-pagination",t.pagination,!1))],1)],1)},v=[],$=n(h,m,v,!1,null,null,null,null);const d=$.exports;var y=n({extends:d,computed:{buttons(){return[{icon:"add",text:this.$t("add"),click:()=>this.$drawer("retour/redirects/create")}]},columns(){let r={from:{label:this.$t("retour.redirects.from"),type:"path",width:"7/20"},to:{label:this.$t("retour.redirects.to"),type:"link",width:"7/20"},status:{label:this.$t("retour.redirects.status"),type:"status",width:"1/10"},priority:{label:this.$t("retour.redirects.priority.abbr"),type:"priority",width:"1/10"}};return this.stats&&(r.hits={label:this.$t("retour.hits"),width:"1/10",type:"count"}),r},empty(){return{icon:"shuffle",text:this.$t("retour.redirects.empty")}}},methods:{onCell({row:r,columnIndex:t}){this.$drawer(`retour/redirects/${this.id(r.from)}/edit`,{query:{column:t}})},options(r){return[{text:this.$t("edit"),icon:"edit",click:()=>this.$drawer(`retour/redirects/${this.id(r.from)}/edit`)},{text:this.$t("remove"),icon:"trash",click:()=>this.$dialog(`retour/redirects/${this.id(r.from)}/delete`)}]}}},null,null,!1,null,null,null,null);const b=y.exports;var k=n({extends:d,computed:{buttons(){return[{icon:"trash",text:this.$t("retour.failures.clear"),click:()=>this.$dialog("retour/failures/flush")}]},columns(){return{path:{label:this.$t("retour.failures.path"),type:"path",width:"1/3"},referrer:{label:this.$t("retour.failures.referrer"),type:"path",width:"1/3"},last:{label:this.$t("retour.last"),type:"date",width:"2/8"},hits:{label:this.$t("retour.hits"),type:"count",width:"1/16",align:"right"}}},empty(){return{icon:"alert",text:this.$t("retour.failures.empty")}}},methods:{options(r){return[{text:this.$t("retour.failures.resolve"),icon:"add",click:()=>this.$drawer(`retour/failures/${this.id(r.path)}/resolve`)},{text:this.$t("remove"),icon:"trash",click:()=>this.$dialog(`retour/failures/${this.id(r.path)}/delete`)}]}}},null,null,!1,null,null,null,null);const g=k.exports,Pt="",w={props:{data:[Object,Array],stats:[Boolean,Array],tabs:Array,timespan:Object},computed:{reports(){return[{label:this.$t("retour.system.redirects"),value:this.data.redirects},{label:this.$t("retour.system.failures"),value:this.data.failures},{label:this.$t("retour.system.deleteAfter"),value:this.$t("retour.system.deleteAfter.months",{count:this.data.deleteAfter})},{label:this.$t("retour.system.support"),value:`ðŸ’› ${this.$t("retour.system.support.donate")}`,link:"https://paypal.me/distantnative",theme:"positive"}]}}};var x=function(){var t=this,e=t._self._c;return e("k-inside",{staticClass:"k-retour-view k-retour-system-view",scopedSlots:t._u([{key:"topbar",fn:function(){return[e("k-retour-timespan",{attrs:{timespan:t.timespan}})]},proxy:!0}])},[t.stats?e("k-retour-stats",{attrs:{data:t.stats,timespan:t.timespan}}):t._e(),e("k-retour-tabs",{attrs:{tabs:t.tabs,tab:"system"}}),e("k-stats",{attrs:{reports:t.reports}}),e("k-text",{staticClass:"k-help",domProps:{innerHTML:t._s(t.$t("retour.system.docs",{docs:"https://github.com/distantnative/retour-for-kirby"}))}})],1)},C=[],F=n(w,x,C,!1,null,null,null,null);const M=F.exports,Dt="",O={props:{data:Array},computed:{gradient(){let r="",t=0;const e=this.total/180;for(let s=0;s<this.data.length;s++)r+=`${this.data[s].color} ${t}deg,`,t+=this.data[s].data/e,r+=`${this.data[s].color} ${t}deg,`;return r+="transparent 180deg",r},total(){return this.data.reduce((r,t)=>r+=t.data,0)}}};var S=function(){var t=this,e=t._self._c;return e("figure",{staticClass:"chart-pie"},[e("div",{staticClass:"graph",style:"--gradient: "+t.gradient}),e("figcaption",[t._l(t.data,function(s){return[e("k-icon",{key:s.label+"-icon",style:"--color:"+s.color,attrs:{type:"circle"}}),e("div",{key:s.label+"-no"},[t._v(" "+t._s(new Intl.NumberFormat().format(s.data))+" ")]),e("div",{key:s.label+"-label"},[t._v(" "+t._s(s.label)+" ")])]})],2)])},j=[],R=n(O,S,j,!1,null,null,null,null);const Y=R.exports,Tt="",A={props:{data:Array,timespan:Object},computed:{axisY(){const r=this.max/5;return[1,2,3,4,5].map(t=>{let e=t*r;return e>=1e3&&(e=Math.floor(e/100)/10+"k"),e})},format(){return{day:"HH",week:"ddd",month:"D",year:"MMM",months:"MMM YY"}[this.timespan.unit]??"D MMM"},subunit(){return{day:"hour",year:"month"}[this.timespan.unit]??"day"},max(){let r=Math.max(...this.data.map(t=>t.areas.reduce((e,s)=>e+=s.data,0)));if(r>0){const t=r.toString().length,e=Math.pow(10,t)/4;return Math.ceil(r*1.1/e)*e}return 5}},methods:{bounds(r,t){const e=r.areas.slice(0,t).reduce((s,a)=>s+=a.data,0);return{path:e+r.areas[t].data,mask:e}},clip(r,t){let e=this.bounds(this.data[r],t),s={path:0,mask:0};return this.data[r+1]&&(s=this.bounds(this.data[r+1],t)),`--p0: ${e.path/this.max}; --p1: ${s.path/this.max}; --m0: ${e.mask/this.max}; --m1: ${s.mask/this.max};`},color(r,t){const e=this.data[r+1];if(e){const s=this.$library.dayjs(e.label),a=this.$library.dayjs();if(s.isAfter(a,this.subunit))return"transparent"}return t.color},isCurrent(r){const t=this.$library.dayjs();return this.$library.dayjs(r.label).isSame(t,this.subunit)},label(r){return this.$library.dayjs(r.label).format(this.format)},onZoom(r){const t=this.$library.dayjs(r.label);this.$reload({query:{from:t.startOf(this.subunit).format("YYYY-MM-DD"),to:t.endOf(this.subunit).format("YYYY-MM-DD")}})}}};var P=function(){var t=this,e=t._self._c;return e("table",{staticClass:"chart-areas"},[e("thead",[e("tr",t._l(t.axisY,function(s){return e("th",{key:s},[t._v(" "+t._s(s)+" ")])}),0)]),e("tbody",t._l(t.data,function(s,a){return e("tr",{key:a,on:{dblclick:function(c){return t.onZoom(s)}}},t._l(s.areas,function(c,u){return e("td",{key:a+"_"+u,style:`--color: ${t.color(a,c)}; ${t.clip(a,u)}`})}),0)}),0),e("tfoot",{attrs:{"data-less":t.data.length>30}},t._l(t.data,function(s){return e("tr",{key:s.label,attrs:{"data-current":t.isCurrent(s)},on:{dblclick:function(a){return t.onZoom(s)}}},[e("td",[t._v(t._s(t.label(s)))])])}),0)])},D=[],T=n(A,P,D,!1,null,null,null,null);const q=T.exports,qt="",z={components:{Pie:Y,Timeline:q},props:{data:Array,timespan:Object},computed:{areas(){return this.data.map(r=>({label:r.date,areas:[{data:r.redirected,color:"var(--color-blue-600)"},{data:r.resolved,color:"var(--color-gray-300)"},{data:r.failed,color:"var(--color-red-600)"}]}))},pie(){return[{data:this.data.reduce((r,t)=>r+=t.redirected,0),color:"var(--color-blue-600)",label:this.$t("retour.stats.redirected")},{data:this.data.reduce((r,t)=>r+=t.resolved,0),color:"var(--color-gray-300)",label:this.$t("retour.stats.resolved")},{data:this.data.reduce((r,t)=>r+=t.failed,0),color:"var(--color-red-600)",label:this.$t("retour.stats.failed")}]}}};var I=function(){var t=this,e=t._self._c;return e("section",{staticClass:"k-retour-stats"},[e("pie",{attrs:{data:t.pie}}),e("timeline",{attrs:{data:t.areas,timespan:t.timespan}})],1)},V=[],U=n(z,I,V,!1,null,null,null,null);const Z=U.exports,zt="",E={props:{tab:String,tabs:Array}};var N=function(){var t=this,e=t._self._c;return e("div",{staticClass:"k-retour-tabs",attrs:{"data-end":t.tabs.length<2}},[e("k-tabs",{attrs:{tab:t.tab,tabs:t.tabs}}),t._t("buttons")],2)},H=[],L=n(E,N,H,!1,null,null,null,null);const B=L.exports,W={props:{timespan:Object},methods:{icon(r){return this.isCurrentUnit(r)===!0?this.timespan.isCurrent?"retour-circle-focus":"circle-nested":"circle"},isCurrentUnit(r){return r===this.timespan.unit||r==="all"&&this.timespan.isAll},navigate(r){const t=this.timespan.unit,e=this.$library.dayjs(this.timespan.from),s=this.$library.dayjs(this.timespan.to);this.update({from:e[r](1,t).startOf(t),to:s[r](1,t).endOf(t)})},set(r){if(r==="all")return this.update({from:this.$library.dayjs(this.timespan.first),to:this.$library.dayjs(this.timespan.last)});let t=this.$library.dayjs(this.timespan.from);(r===this.timespan.unit||r==="today")&&(r=this.timespan.unit,t=this.$library.dayjs()),this.update({from:t.startOf(r),to:t.endOf(r)})},update({from:r,to:t}){this.$reload({query:{from:r.format("YYYY-MM-DD"),to:t.format("YYYY-MM-DD")}})}}};var X=function(){var t=this,e=t._self._c;return e("k-button-group",{staticClass:"k-retour-timespan",attrs:{layout:"collapsed"}},[e("k-dropdown",[e("k-button",{attrs:{dropdown:!0,text:t.timespan.label,icon:"calendar",size:"xs",variant:"filled"},on:{click:function(s){return t.$refs.units.toggle()}}}),e("k-dropdown-content",{ref:"units",attrs:{"x-align":"end"}},[t._l(["all","year","month","day"],function(s){return s!=="all"||t.timespan.hasAll?e("k-dropdown-item",{key:s,attrs:{current:t.isCurrentUnit(s),icon:t.icon(s),size:"xs",variant:"filled"},on:{click:function(a){return t.set(s)}}},[t._v(" "+t._s(t.$t("retour.stats.mode."+s))+" ")]):t._e()}),e("hr"),e("k-dropdown-item",{attrs:{size:"xs",icon:"merge",variant:"filled"},on:{click:()=>t.set("today")}},[t._v(" "+t._s(t.$t("retour.timespan.today.label"))+" ")]),e("k-dropdown-item",{attrs:{size:"xs",icon:"calendar",variant:"filled"},on:{click:()=>t.$dialog("retour/timespan")}},[t._v(" "+t._s(t.$t("retour.timespan.set.label"))+" ")])],2)],1),e("k-button",{attrs:{icon:"angle-left",size:"xs",variant:"filled",disabled:!t.timespan.hasPrev||t.timespan.isAll},on:{click:function(s){return t.navigate("subtract")}}}),e("k-button",{attrs:{disabled:!t.timespan.hasNext||t.timespan.isAll,icon:"angle-right",size:"xs",variant:"filled"},on:{click:function(s){return t.navigate("add")}}})],1)},J=[],G=n(W,X,J,!1,null,null,null,null);const K=G.exports,It="",Q={props:{row:Object},computed:{title(){return this.$t("retour.hits.last")+": "+(this.row.last??"-")}}};var tt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"k-count-preview-field",attrs:{title:t.title}},[t.row.hits>0?[t._v(" "+t._s(t.row.hits)+" "),e("k-icon",{attrs:{title:t.title,type:"clock"}})]:e("p",[t._v("â€“")])],2)},et=[],rt=n(Q,tt,et,!1,null,null,null,null);const st=rt.exports,at={props:{column:{type:Object,default:()=>({})},field:Object,value:[String,Object]},computed:{isExternal(){return this.value&&this.value.startsWith("http")},link(){return this.isExternal?this.value:window.panel.$urls.site+"/"+this.value}}};var nt=function(){var t=this,e=t._self._c;return e("p",{staticClass:"k-url-field-preview k-path-field-preview"},[e("k-link",{attrs:{to:t.link,title:`${t.column.label}: ${t.value}`,target:"_blank"},nativeOn:{click:function(s){s.stopPropagation()}}},[t._v(" "+t._s(t.value)+" ")])],1)},it=[],lt=n(at,nt,it,!1,null,null,null,null);const ot=lt.exports,Vt="",ct={props:{value:String,column:Object}};var ut=function(){var t=this,e=t._self._c;return e("div",{staticClass:"k-priority-field-preview"},[t.value?e("k-icon",{attrs:{type:"bolt",title:t.column.label}}):e("p",[t._v("â€“")])],1)},dt=[],_t=n(ct,ut,dt,!1,null,null,null,null);const pt=_t.exports,_={computed:{color(){return this.value?parseInt(this.value)>=400?"var(--color-negative-light)":parseInt(this.value)>=300?"var(--color-positive-light)":"var(--color-focus-light)":"var(--color-border)"}}},Ut="",ft={mixins:[_],props:{value:String,row:Object,column:Object}};var ht=function(){var t=this,e=t._self._c;return e("div",{staticClass:"k-status-field-preview",attrs:{title:`${t.column.label}: ${t.value}`}},[e("k-icon",{style:"color: "+t.color,attrs:{type:"circle-filled"}}),e("kbd",[t._v(t._s(t.value))])],1)},mt=[],vt=n(ft,ht,mt,!1,null,null,null,null);const $t=vt.exports,yt={extends:"k-select-field",mixins:[_],methods:{onInput(r){this.value=r}}};var bt=function(){var t=this,e=t._self._c;return e("k-field",t._b({staticClass:"k-select-field",attrs:{input:t._uid}},"k-field",t.$props,!1),[e("k-input",t._g(t._b({ref:"input",attrs:{id:t._uid,type:"select",theme:"field"},on:{input:t.onInput},scopedSlots:t._u([{key:"before",fn:function(){return[e("k-icon",{attrs:{type:"circle-filled",color:t.color}})]},proxy:!0}])},"k-input",t.$props,!1),t.$listeners))],1)},kt=[],gt=n(yt,bt,kt,!1,null,null,null,null);const wt=gt.exports;panel.plugin("distantnative/retour",{components:{"k-count-field-preview":st,"k-path-field-preview":ot,"k-priority-field-preview":pt,"k-status-field-preview":$t,"k-retour-stats":Z,"k-retour-tabs":B,"k-retour-timespan":K,"k-retour-redirects-view":b,"k-retour-failures-view":g,"k-retour-system-view":M},fields:{"retour-status":wt},icons:{"retour-circle-focus":'<path d="M12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20ZM12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22ZM12 14C10.8954 14 10 13.1046 10 12C10 10.8954 10.8954 10 12 10C13.1046 10 14 10.8954 14 12C14 13.1046 13.1046 14 12 14Z"></path>'}})})();
